package com.jacaranda.controller;

import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import com.jacaranda.entity.Customer;

@RestController
@RequestMapping(path = "/Api")
public class CustomerController {
	private List<Customer> custom = new ArrayList<>();

	@PostMapping(path = "/post")
	public ResponseEntity<?> postCustom(@RequestBody Customer c1) {
		custom.add(c1);

		return ResponseEntity.status(HttpStatus.CREATED).body(c1);
	}

	@GetMapping(path = "/get")
	public ResponseEntity<?> getCustom(@RequestParam int id) {
		ResponseEntity<?> res = null;

		if (custom == null || custom.isEmpty()) {
			res = ResponseEntity.status(HttpStatus.NOT_FOUND).body("No existen empleados");
		} else {
			res = ResponseEntity.status(HttpStatus.OK).body(custom.stream().filter(s -> id == s.getId()));
		}
		
		return res;
	}

	@PutMapping(path = "/put")
	public ResponseEntity<?> putCustom(@RequestBody Customer clienteActualizar) {
		ResponseEntity<?> res = null;
		Iterator<Customer> iteCus = custom.iterator();
		Customer c = null;
		
		while (iteCus.hasNext() && c == null) {
			Customer cliente = iteCus.next();
			
			if (cliente.getId() == clienteActualizar.getId()) {
				c = cliente;
				
				cliente.setName(clienteActualizar.getName());
				cliente.setSurname(clienteActualizar.getSurname());
				cliente.setBirthDate(clienteActualizar.getBirthDate());
				cliente.setAddress(clienteActualizar.getAddress());
				cliente.setCity(clienteActualizar.getCity());
				cliente.setDni(clienteActualizar.getDni());
				cliente.setCountry(clienteActualizar.getCountry());
				cliente.setMobileNumber(clienteActualizar.getMobileNumber());
				cliente.setGender(clienteActualizar.getGender());
			}
		}
		
		if (c == null) {
			res = ResponseEntity.status(HttpStatus.NOT_FOUND).body("No existe empleado");
		} else {
			res = ResponseEntity.status(HttpStatus.OK).body(clienteActualizar);
		}
		
		return res;
	}
	
	private Customer getCustomById(int id) {
		return custom.stream().filter(c -> c.getId() == id).findFirst().orElse(new Customer());
	}
	
	@DeleteMapping(path = "/delete")
	public ResponseEntity<?> deleteCustom(@RequestParam int id) {
		ResponseEntity res = null;
		Iterator<Customer> iteCustom = custom.iterator();
		Customer c = null;
		
		while (iteCustom.hasNext() && c == null) {
			Customer cliente = iteCustom.next();
			
			if (cliente.getId() == id) {
				c = cliente;
				custom.remove(cliente);
			}
		}
		
		if (c == null) {
			res = ResponseEntity.status(HttpStatus.NOT_FOUND).body("No existe empleado");
		} else {
			res = ResponseEntity.status(HttpStatus.OK).body(c);
		}
		
		return res;
	}
}
